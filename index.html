<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>音楽再生デモ</title>
</head>
<body>
  <h1>音楽再生デモ</h1>
  <p id="status">時刻を同期中...</p>
  <button id="start-button">再生を有効化する</button>
  <audio id="audio" src="your-audio-file.mp3" preload="auto"></audio>

  <script>
    // 現在の日付を取得して、指定時刻（例: 今日の20時00分00秒）を設定
    function getTargetTime(hour, minute, second) {
      const now = new Date();
      const targetTime = new Date(now.getFullYear(), now.getMonth(), now.getDate(), hour, minute, second);
      return targetTime.getTime();
    }

    // 現在のNTP時刻を取得
    async function fetchCurrentTime() {
      try {
        const response = await fetch('https://worldtimeapi.org/api/timezone/Etc/UTC');
        const data = await response.json();
        return new Date(data.utc_datetime).getTime();
      } catch (error) {
        console.error('時刻取得エラー:', error);
        return Date.now();
      }
    }

    async function main() {
      const status = document.getElementById('status');
      const audio = document.getElementById('audio');
      const button = document.getElementById('start-button');

      // 今日の20時00分00秒を指定
      const targetTime = getTargetTime(14, 44, 0); // 20:00:00 に設定

      // ボタンのクリックで音楽再生の準備を開始
      button.addEventListener('click', async () => {
        // 現在のNTP時刻を取得
        const ntpTime = await fetchCurrentTime();
        const delay = targetTime - ntpTime;

        if (delay > 0) {
          status.textContent = `再生開始まで: ${delay / 1000}秒`;
          button.disabled = true; // ボタンを無効化

          setTimeout(() => {
            audio.play().then(() => {
              status.textContent = '再生中';
            }).catch(err => {
              status.textContent = '再生エラー: ' + err.message;
            });
          }, delay);
        } else {
          status.textContent = '指定時刻が過ぎています。';
        }
      });
    }

    main();
  </script>
</body>
</html>
